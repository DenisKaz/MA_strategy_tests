# FAQ – Часто задаваемые вопросы

## Установка и запуск

### Q: Какой Python требуется?
**A:** Python 3.9 или выше. Проверьте:
```bash
python3 --version
```

### Q: Как установить зависимости?
**A:** 
```bash
pip install -r requirements.txt
```

Если используете conda:
```bash
conda create -n ma_strategy python=3.9
conda activate ma_strategy
pip install -r requirements.txt
```

### Q: Как запустить быстрый тест?
**A:**
```bash
# Вариант 1: Использовать скрипт примеров
bash bin/commands.sh 1

# Вариант 2: Вручную
python bin/fetch.py --symbols BTC/USDT --years 0.0027 --timeframes 1h
python bin/analyze.py --ma-min 5 --ma-max 100
```

---

## Загрузка данных

### Q: Как долго идёт загрузка?
**A:** Зависит от объёма:
- 1 инструмент, 1 год, все TF: **~3–5 минут**
- 1 инструмент, 4 года, все TF: **~10–15 минут**
- 3 инструмента, 4 года, все TF: **~25–40 минут**

Основной фактор: количество API запросов × rate limit биржи (обычно 30–100 запросов/минуту).

### Q: Какие биржи поддерживаются?
**A:** Все биржи из CCXT (100+). Популярные:
- `bybit` (по умолчанию)
- `binance`
- `kraken`
- `coinbase`
- `okx`

Используйте:
```bash
python bin/fetch.py --exchange binance --symbols BTC/USDT
```

### Q: Почему некоторые символы не загрузились?
**A:** Биржа может не поддерживать эту пару. Проверьте:
1. Правильность формата: `BASE/QUOTE` (e.g., `BTC/USDT`)
2. На сайте биржи (вручную проверьте, торгуется ли эта пара)
3. Логи: включите `-v` для подробного вывода

```bash
python bin/fetch.py --symbols BTC/USDT -v
```

### Q: Как загрузить более старые данные?
**A:** Увеличьте `--years`:
```bash
python bin/fetch.py --symbols BTC/USDT --years 10
```

Ограничения:
- Чем старше, тем больше времени
- Некоторые биржи хранят < 4 лет (Binance хранит ~5 лет)

### Q: Может ли я использовать CSV из другого источника?
**A:** Да! Положите CSV в `data/` с названием `exchange_SYMBOL_TIMEFRAME.csv` (e.g., `bybit_BTC_USDT_1h.csv`).

Требуемый формат:
```
datetime,open,high,low,close,volume
2024-01-01 00:00:00+00:00,61000,61500,60900,61200,45.2
2024-01-01 01:00:00+00:00,61200,61800,61000,61500,52.1
```

---

## Анализ

### Q: Как долго идёт анализ?
**A:** Для 4 лет BTC всех TF (~2.5M свечей):
- **MA 5..233 (229), 2 типа (SMA, EMA), 4 TF:**
  - ~2–5 минут (зависит от CPU)

### Q: Как изменить диапазон MA?
**A:** Используйте флаги:
```bash
python bin/analyze.py --ma-min 10 --ma-max 100
```

Диапазон по умолчанию: 5–233 (Фибоначчи-подобный: 5, 8, 13, 21, 34, 55, 89, 144, 233).

### Q: Как изменить целевое движение (target)?
**A:**
```bash
# Целевое движение 5% вместо 3%
python bin/analyze.py --target 0.05
```

### Q: Как ускорить анализ?
**A:** Несколько опций:
1. **Ограничить MA периоды:**
   ```bash
   python bin/analyze.py --ma-min 20 --ma-max 100
   ```

2. **Уменьшить lookahead (редактировать config.py):**
   ```python
   max_lookahead: 100  # вместо 200
   ```

3. **Использовать только SMA:**
   ```bash
   python bin/analyze.py --ma-types SMA
   ```

### Q: Почему результаты содержат очень мало событий?
**A:** Возможные причины:
1. **Много условий для отскока:**
   - Касание wick только (не тело)
   - Минимум 5 свечей до/после без касаний
   - Минимум 30% размера свечи = wick
   
   Это **строгие критерии**, поэтому событий мало.

2. **Слишком жёсткие параметры:**
   ```bash
   # Попробуйте ослабить
   python bin/analyze.py --alpha-wick 0.20 --n-pre 3 --n-post 3
   ```

---

## Интерпретация результатов

### Q: Что означает win_rate = 55%?
**A:** Из всех найденных отскоков 55% достигли целевого движения (3% по умолчанию) без返回 к цене касания.

**Важно:** Это НЕ торговый процент выигрыша! Потому что:
- Не учтены комиссии (0.1–0.2% за каждую сделку)
- Не учтен слиппаж (реальная цена может быть хуже)
- Есть look-ahead bias (используются будущие 200 свечей)

Реальный процент выигрыша = win_rate - комиссии × 2 ≈ 55% - 0.2% = 54.8%

### Q: Какой win_rate считается "хорошим"?
**A:** Зависит от контекста:
- **> 60%** = отличный сигнал (нужна ещё проверка)
- **50–60%** = нормальный
- **< 50%** = хуже, чем random chance (но может быть ценно для short-позиций)

Но помните: вы тестировали на ОДНИХ И ТЕХ ЖЕ данных! Требуется тестирование на другом инструменте/периоде.

### Q: Как сравнить разные MA?
**A:** Используйте результаты:
```bash
# После анализа, посмотрите топ-20
cat results/analysis_summary.csv | sort -t',' -k8 -rn | head -20
```

Сортируйте по колонке win_rate (8-я колонка).

### Q: Что такое adverse_max_%?
**A:** Максимальное противоположное движение после первого движения к цели.

Пример:
- Отскок вверх на 3.2% = SUCCESS
- Но перед тем как уйти на 3.2% вверх, цена упала на 1.5% = adverse_max = 1.5%

Это мера **волатильности/шума** после ввода. Меньше = лучше (более чистое движение).

---

## Использование результатов

### Q: Можно ли использовать эти MA в реальной торговле?
**A:** **НЕ рекомендуется напрямую!** Потому что:

1. **Look-ahead bias:** Анализ проверяет 200 свечей вперёд (их не знаете в реальном времени)
2. **Overfitting:** MA найдена на одних данных (может не работать на новых)
3. **Отсутствуют стопы и мани-менеджмент**
4. **Не учтены комиссии, слиппаж**

**Правильный процесс:**
1. Найти лучший MA в анализе ← ВЫ ЗДЕСЬ
2. Бэктест с реальными комиссиями (-0.2%) и стопами
3. Тестирование на **других** инструментах (OOS test)
4. Paper trading 2–4 недели
5. Реальная торговля микро-объёмом

### Q: Как использовать результаты в Pine Script / TradingView?
**A:** Смотрите `examples_pinescript_guide.pine`. Это примерный код, который показывает:
- Как вычислить MA в реальном времени
- Как обнаружить wick-touch
- Как генерировать сигналы

**Важно:** Это не полная торговая система. Нужны:
- Стоп-лосс (e.g., -2% от входа)
- Take-profit (e.g., +3% от входа)
- Фильтры (volume, trend, volatility)
- Бэктест с этими параметрами

### Q: Как экспортировать результаты?
**A:** Результаты уже в CSV:
```bash
# Скопировать в Excel
cp results/analysis_summary.csv ~/Desktop/

# Посмотреть в Python
python -c "
import pandas as pd
df = pd.read_csv('results/analysis_summary.csv')
print(df.describe())
"
```

---

## Отладка и ошибки

### Q: Ошибка "Не удается подключиться к бирже"
**A:**
```
ccxt.NetworkError: ... 418 I'm a teapot ...
```

Это означает rate limit. Решение:
```bash
# Увеличьте задержку (снизьте лимит запросов)
python bin/fetch.py --limit 500  # вместо 1000
```

### Q: Ошибка "Символ не найден"
**A:**
```
✗ Символ НЕ найден: FAKE/USDT
```

Решение:
1. Проверьте формат: должно быть `BASE/QUOTE`
2. Проверьте на сайте биржи, торгуется ли эта пара
3. Попробуйте другую биржу (если необходимо)

### Q: CSV файл пустой или содержит мало строк
**A:**
1. Проверьте лог:
   ```bash
   python bin/fetch.py -v  # подробный лог
   ```

2. Проверьте размер файла:
   ```bash
   ls -lh data/
   ```

3. Попробуйте снова:
   ```bash
   rm data/bybit_BTC_USDT_*.csv  # удалить старые
   python bin/fetch.py --symbols BTC/USDT --years 1
   ```

### Q: Анализ зависает или очень медленный
**A:**
1. Ограничьте MA диапазон:
   ```bash
   python bin/analyze.py --ma-min 20 --ma-max 100
   ```

2. Ограничьте lookahead (отредактировать `src/config.py`):
   ```python
   max_lookahead: 100  # вместо 200
   ```

3. Используйте только SMA:
   ```bash
   python bin/analyze.py --ma-types SMA
   ```

### Q: Python module not found
**A:** Убедитесь, что установили зависимости:
```bash
pip install -r requirements.txt
```

Или если в виртуальном окружении:
```bash
source .venv/bin/activate
pip install -r requirements.txt
```

---

## Тестирование

### Q: Как запустить unit-тесты?
**A:** 
```bash
# Установить pytest (если нет)
pip install pytest pytest-cov

# Запустить все тесты
pytest tests/

# Запустить с покрытием
pytest tests/ --cov=src
```

### Q: Как добавить свой тест?
**A:** Создайте файл `tests/test_myfeature.py`:
```python
import pytest
from src.analyzer import Analyzer

def test_my_feature(analyzer):
    # ваш тест
    assert True
```

---

## Производительность

### Q: Как улучшить производительность?
**A:** Несколько опций:

1. **Параллелизм (для 10M+ свечей):**
   - Используйте multiprocessing для разных MA периодов
   - Требует модификации `src/analyzer.py`

2. **Кэширование MA:**
   - Вычислить MA один раз, использовать для разных пороговых значений
   - Требует модификации логики

3. **Парquet вместо CSV:**
   - Парquet быстрее для больших файлов
   - Требует `pip install pyarrow`

### Q: Какие у меня требования к ПК?
**A:**
- **Минимум:** 4 GB RAM, 2-core CPU
- **Рекомендуется:** 8 GB RAM, 4-core CPU
- **Для 10M+ свечей:** 16 GB RAM, 8-core CPU

Основной лимит: память (1M свечей ≈ 50 MB DataFrame).

---

## Общие вопросы

### Q: Лицензия?
**A:** MIT (свободно используйте, модифицируйте, распространяйте).

### Q: Как сообщить об ошибке?
**A:** Создайте issue на GitHub или отправьте письмо.

### Q: Как внести вклад?
**A:** Pull requests приветствуются! Особенно нужна помощь с:
- Параллелизмом (для ускорения)
- Бэктест-фреймворком
- Визуализацией (графики)
- Документацией

---

## Ссылки

- **Документация архитектуры:** [ARCHITECTURE.md](./ARCHITECTURE.md)
- **Быстрый старт:** [README.md](./README.md)
- **Примеры команд:** `bash bin/commands.sh`
- **CCXT документация:** https://docs.ccxt.com/

---

**Последнее обновление:** November 16, 2025
